<div class="container">
  <aside>
    <div class="top">
      <div class="logo">
        <img src="favicon.png" alt="logo">
        <h2 class="noml">Corpogam</h2>
      </div>
      <div class="close" id="close-btn">
        <span><i class="pi pi-times"></i></span>
      </div>
    </div>

    <div class="sidebar">
    <a href="/dashboard" >
                    <span><i class="fa-regular fa-house"></i></span>
                    <h3>Inicio</h3>
                </a>
                <a href="/registro">
                    <span><i class="fa-regular fa-rectangle-list"></i></span>
                    <h3>Registro</h3>
                </a>
                <a href="/vacunas">
                    <span><i class="fa-solid fa-syringe"></i></span>
                    <h3>Vacunas</h3>
                </a>

                <a href="/animales">
                    <span><i class="fa-solid fa-cow"></i></span>
                    <h3>Animales</h3>
                </a>
                <a href="/semaforo" class="active">
                    <span><i class="fa-solid fa-traffic-light"></i></span>
                    <h3>Semaforo</h3>
                </a>
                <a href="#">
                    <span><i class="fa-solid fa-chart-simple"></i></span>
                    <h3>Reportes</h3>
                </a>
                <a href="#">
                    <span><i class="fa-solid fa-right-from-bracket"></i></span>
                    <h3>Cerrar Sesion</h3>
                </a>
    </div>
  </aside>

  <main>
  <h1>Bienvenido, al estado de Vacunas</h1>

  <div class="date">
    <p>{{ fechaActual }}, {{ horaActual }}</p>
  </div>

  <!-- Mensaje de carga -->
  <div *ngIf="cargando" class="loading">Cargando vacunas...</div>
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <!-- ‚≠ê Vacunas a Tiempo (Verde) -->
  <div class="tbl_semaforo">
    <div class="tabla-header">
      <h2>Vacunas a Tiempo ({{ vacunasATiempoFiltradas.length }}/{{ vacunasATiempo.length }})</h2>
      <div class="buscador">
        <input 
          type="text" 
          placeholder="üîç Buscar por c√≥digo, alias o vacuna..."
          [(ngModel)]="busquedaATiempo"
          class="input-buscar"
        >
        <button 
          *ngIf="busquedaATiempo" 
          class="btn-limpiar"
          (click)="limpiarBusqueda('aTiempo')"
          title="Limpiar b√∫squeda"
        >
          ‚úï
        </button>
      </div>
    </div>
    
    <table>
      <thead>
        <tr>
          <th>C√≥digo del Animal</th>
          <th>Alias</th>
          <th>Vacuna</th>
          <th>Fecha de Aplicaci√≥n</th>
          <th>Pr√≥xima Dosis</th>
          <th>Estado</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vacuna of vacunasATiempoFiltradas">
          <td>{{ vacuna.codigo_animal }}</td>
          <td>{{ vacuna.alias }}</td>
          <td>{{ vacuna.nombre_vacuna }}</td>
          <td>{{ formatearFecha(vacuna.fecha_aplicacion) }}</td>
          <td>{{ formatearFecha(vacuna.proxima_dosis) }}</td>
          <td class="success">{{ obtenerEstadoTexto(vacuna) }}</td>
          <td><button class="btn-modal" (click)="abrirModal(vacuna)">Actualizar</button></td>
        </tr>
        <tr *ngIf="vacunasATiempoFiltradas.length === 0 && busquedaATiempo">
          <td colspan="7" style="text-align: center;">
            No se encontraron resultados para "{{ busquedaATiempo }}"
          </td>
        </tr>
        <tr *ngIf="vacunasATiempo.length === 0 && !busquedaATiempo">
          <td colspan="7" style="text-align: center;">No hay vacunas en este estado</td>
        </tr>
      </tbody>
    </table>
    <br>
  </div>

  <!-- ‚≠ê Vacunas Pr√≥ximas a Vencer (Amarillo) -->
  <div class="tbl_semaforo">
    <div class="tabla-header">
      <h2>Vacunas Pr√≥ximas a Vencer ({{ vacunasProximasFiltradas.length }}/{{ vacunasProximas.length }})</h2>
      <div class="buscador">
        <input 
          type="text" 
          placeholder="üîç Buscar por c√≥digo, alias o vacuna..."
          [(ngModel)]="busquedaProximas"
          class="input-buscar"
        >
        <button 
          *ngIf="busquedaProximas" 
          class="btn-limpiar"
          (click)="limpiarBusqueda('proximas')"
          title="Limpiar b√∫squeda"
        >
          ‚úï
        </button>
      </div>
    </div>
    
    <table>
      <thead>
        <tr>
          <th>C√≥digo del Animal</th>
          <th>Alias</th>
          <th>Vacuna</th>
          <th>Fecha de Aplicaci√≥n</th>
          <th>Pr√≥xima Dosis</th>
          <th>Estado</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vacuna of vacunasProximasFiltradas">
          <td>{{ vacuna.codigo_animal }}</td>
          <td>{{ vacuna.alias }}</td>
          <td>{{ vacuna.nombre_vacuna }}</td>
          <td>{{ formatearFecha(vacuna.fecha_aplicacion) }}</td>
          <td>{{ formatearFecha(vacuna.proxima_dosis) }}</td>
          <td class="warning">Pr√≥ximo a Vencer</td>
          <td><button class="btn-modal warning-btn" (click)="abrirModal(vacuna)">Actualizar</button></td>
        </tr>
        <tr *ngIf="vacunasProximasFiltradas.length === 0 && busquedaProximas">
          <td colspan="7" style="text-align: center;">
            No se encontraron resultados para "{{ busquedaProximas }}"
          </td>
        </tr>
        <tr *ngIf="vacunasProximas.length === 0 && !busquedaProximas">
          <td colspan="7" style="text-align: center;">No hay vacunas en este estado</td>
        </tr>
      </tbody>
    </table>
    <br>
  </div>

  <!-- ‚≠ê Vacunas Vencidas (Rojo) -->
  <div class="tbl_semaforo">
    <div class="tabla-header">
      <h2>Vacunas Vencidas ({{ vacunasVencidasFiltradas.length }}/{{ vacunasVencidas.length }})</h2>
      <div class="buscador">
        <input 
          type="text" 
          placeholder="üîç Buscar por c√≥digo, alias o vacuna..."
          [(ngModel)]="busquedaVencidas"
          class="input-buscar"
        >
        <button 
          *ngIf="busquedaVencidas" 
          class="btn-limpiar"
          (click)="limpiarBusqueda('vencidas')"
          title="Limpiar b√∫squeda"
        >
          ‚úï
        </button>
      </div>
    </div>
    
    <table>
      <thead>
        <tr>
          <th>C√≥digo del Animal</th>
          <th>Alias</th>
          <th>Vacuna</th>
          <th>Fecha de Aplicaci√≥n</th>
          <th>Pr√≥xima Dosis</th>
          <th>Estado</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vacuna of vacunasVencidasFiltradas">
          <td>{{ vacuna.codigo_animal }}</td>
          <td>{{ vacuna.alias }}</td>
          <td>{{ vacuna.nombre_vacuna }}</td>
          <td>{{ formatearFecha(vacuna.fecha_aplicacion) }}</td>
          <td>{{ formatearFecha(vacuna.proxima_dosis) }}</td>
          <td class="danger">Vencida - Urgente</td>
          <td><button class="btn-modal danger-btn" (click)="abrirModal(vacuna)">Actualizar</button></td>
        </tr>
        <tr *ngIf="vacunasVencidasFiltradas.length === 0 && busquedaVencidas">
          <td colspan="7" style="text-align: center;">
            No se encontraron resultados para "{{ busquedaVencidas }}"
          </td>
        </tr>
        <tr *ngIf="vacunasVencidas.length === 0 && !busquedaVencidas">
          <td colspan="7" style="text-align: center;">No hay vacunas en este estado</td>
        </tr>
      </tbody>
    </table>
    <br>
  </div>
</main>
  <!-- Modal-->
   <div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Actualizar Vacuna</h2>
      <button class="btn-cerrar" (click)="cerrarModal()">√ó</button>
    </div>
    
    <div class="modal-body">
      <div class="info-animal">
        <p><strong>Animal:</strong> {{ vacunaSeleccionada?.codigo_animal }} - {{ vacunaSeleccionada?.alias }}</p>
        <p><strong>Vacuna:</strong> {{ vacunaSeleccionada?.nombre_vacuna }}</p>
      </div>

      <form (ngSubmit)="actualizarVacuna()">
        <div class="form-group">
          <label for="fechaAplicacion">Nueva Fecha de Aplicaci√≥n:</label>
          <input 
            type="date" 
            id="fechaAplicacion" 
            [(ngModel)]="nuevaFechaAplicacion"
            name="fechaAplicacion"
            required
          >
        </div>

        <div class="form-group">
          <label for="proximaDosis">Nueva Pr√≥xima Dosis:</label>
          <input 
            type="date" 
            id="proximaDosis" 
            [(ngModel)]="nuevaProximaDosis"
            name="proximaDosis"
            required
          >
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
          <button type="submit" class="btn-guardar" [disabled]="guardando">
            {{ guardando ? 'Guardando...' : 'Guardar Cambios' }}
          </button>
        </div>
      </form>

      <div *ngIf="mensajeExito" class="mensaje-exito">{{ mensajeExito }}</div>
      <div *ngIf="mensajeError" class="mensaje-error">{{ mensajeError }}</div>
    </div>
  </div>
</div>

  <div class="barra">
    <div class="top">
      <button id="menu_btn">
        <span><i class="fa-solid fa-bars"></i></span>
      </button>
      <div class="theme-toggler">
        <span><i class="fa-solid fa-sun active"></i></span>
        <span><i class="fa-solid fa-moon"></i></span>
      </div>
      <div class="perfil">
        <div class="info">
          <p>Hola, <b>Jeanpi</b></p>
          <small class="text-muted">Administrador</small>
        </div>
        <div class="foto_perfil">
          <img src="Perfil Admin.png" alt="">
        </div>
      </div>
    </div>
  </div>
</div>